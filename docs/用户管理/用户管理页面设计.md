# ç”¨æˆ·ç®¡ç†é¡µé¢è®¾è®¡

## æ¦‚è¿°

ç”¨æˆ·ç®¡ç†é¡µé¢ï¼ˆ`/dashboard/account/user`ï¼‰æ˜¯ N-Admin ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·è´¦å·ç®¡ç†åŠŸèƒ½ã€‚é¡µé¢é‡‡ç”¨ç°ä»£åŒ–çš„ç»„ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒè¡¨æ ¼å’Œå¡ç‰‡ä¸¤ç§è§†å›¾æ¨¡å¼ï¼Œå…·æœ‰ä¸°å¯Œçš„æœç´¢ã€ç­›é€‰ã€æ‰¹é‡æ“ä½œåŠŸèƒ½ã€‚

**é¡µé¢è·¯å¾„**: `src/app/dashboard/account/user/page.tsx`

## ç»„ä»¶å±‚æ¬¡ç»“æ„

```mermaid
graph TD
    A[UserManagementPage] --> B[UserPageHeader]
    A --> C[UserStatistics]
    A --> D[UserFilters]
    A --> E[ViewToggle]
    A --> F[UserTable]
    A --> G[UserCardGrid]
    A --> H[Pagination]
    A --> I[UserDialogs]
    A --> J[FloatingBatchActions]

    F --> F1[UserCard]
    F --> F2[FilterTags]
    G --> G1[UserCard]

    I --> I1[UserForm]
    I --> I2[DeleteConfirmDialog]
    I --> I3[ResetPasswordDialog]
    I --> I4[SessionsDialog]

    style A fill:#e1f5ff
    style F fill:#fff4e6
    style G fill:#fff4e6
```

## æ–‡ä»¶ç›®å½•ç»“æ„

```
src/app/dashboard/account/user/
â”œâ”€â”€ page.tsx                        # ä¸»é¡µé¢ç»„ä»¶
â”œâ”€â”€ layout.tsx                      # é¡µé¢å¸ƒå±€
â”œâ”€â”€ components/                     # UIç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ UserCard.tsx               # ç”¨æˆ·å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ UserCardGrid.tsx           # å¡ç‰‡ç½‘æ ¼å¸ƒå±€
â”‚   â”œâ”€â”€ UserDialogs.tsx            # å¯¹è¯æ¡†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ UserFilters.tsx            # æœç´¢ç­›é€‰ç»„ä»¶
â”‚   â”œâ”€â”€ UserForm.tsx               # ç”¨æˆ·è¡¨å•
â”‚   â”œâ”€â”€ UserPageHeader.tsx         # é¡µé¢å¤´éƒ¨
â”‚   â”œâ”€â”€ UserStatistics.tsx         # ç»Ÿè®¡ä¿¡æ¯ç»„ä»¶
â”‚   â”œâ”€â”€ UserTable.tsx              # è¡¨æ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ FilterTags.tsx             # ç­›é€‰æ ‡ç­¾æ˜¾ç¤º
â”‚   â”œâ”€â”€ FloatingBatchActions.tsx   # æµ®åŠ¨æ‰¹é‡æ“ä½œæ 
â”‚   â”œâ”€â”€ ViewToggle.tsx             # è§†å›¾åˆ‡æ¢å™¨
â”‚   â””â”€â”€ index.ts                   # ç»„ä»¶å¯¼å‡º
â”œâ”€â”€ hooks/                          # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ useUserFilters.ts          # ç­›é€‰çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useUserManagement.ts       # ç”¨æˆ·æ•°æ®å’Œæ“ä½œ
â”‚   â””â”€â”€ useViewMode.ts             # è§†å›¾æ¨¡å¼ç®¡ç†
â”œâ”€â”€ types.ts                        # TypeScriptç±»å‹å®šä¹‰
â””â”€â”€ constants.ts                    # å¸¸é‡é…ç½®
```

## UIç»„ä»¶è¯¦ç»†è¯´æ˜

### 1. UserPageHeaderï¼ˆé¡µé¢å¤´éƒ¨ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserPageHeader.tsx`

**åŠŸèƒ½**:
- æ˜¾ç¤ºé¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
- æä¾›æ“ä½œæŒ‰é’®ï¼šæ·»åŠ ç”¨æˆ·ã€å¯¼å…¥ã€å¯¼å‡ºã€åˆ·æ–°
- æ˜¾ç¤ºç”¨æˆ·æ€»æ•°ç»Ÿè®¡

**Props**:
```typescript
interface UserPageHeaderProps {
  onCreateUser: () => void;      // åˆ›å»ºç”¨æˆ·å›è°ƒ
  onExportUsers: () => void;     // å¯¼å‡ºç”¨æˆ·å›è°ƒ
  onImportUsers: () => void;     // å¯¼å…¥ç”¨æˆ·å›è°ƒ
  onRefresh: () => void;         // åˆ·æ–°æ•°æ®å›è°ƒ
  totalUsers?: number;           // ç”¨æˆ·æ€»æ•°
  activeUsers?: number;          // æ´»è·ƒç”¨æˆ·æ•°
  loading?: boolean;             // åŠ è½½çŠ¶æ€
}
```

### 2. UserStatisticsï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserStatistics.tsx`

**åŠŸèƒ½**:
- å±•ç¤ºç”¨æˆ·ç»Ÿè®¡æ•°æ®å¡ç‰‡
- åŒ…å«æ€»æ•°ã€æ´»è·ƒã€é”å®šç­‰æŒ‡æ ‡
- æ˜¾ç¤ºè¶‹åŠ¿å˜åŒ–ï¼ˆå¢é•¿/ä¸‹é™ï¼‰

**ç»Ÿè®¡ç»´åº¦**:
```typescript
interface UserStatistics {
  overview: {
    total: number;        // æ€»ç”¨æˆ·æ•°
    active: number;       // æ´»è·ƒç”¨æˆ·
    inactive: number;     // éæ´»è·ƒç”¨æˆ·
    locked: number;       // é”å®šç”¨æˆ·
    activeRate: number;   // æ´»è·ƒç‡ï¼ˆ%ï¼‰
  };
  engagement: {
    recentLogins: number;      // è¿‘30å¤©ç™»å½•ç”¨æˆ·æ•°
    recentLoginRate: number;   // è¿‘30å¤©ç™»å½•ç‡ï¼ˆ%ï¼‰
  };
  growth: {
    thisMonth: number;    // æœ¬æœˆæ–°å¢
    lastMonth: number;    // ä¸Šæœˆæ–°å¢
    growthRate: number;   // æœˆå¢é•¿ç‡ï¼ˆ%ï¼‰
    today: number;        // ä»Šæ—¥æ–°å¢
    week: number;         // æœ¬å‘¨æ–°å¢
  };
  distribution: {
    active: number;       // æ´»è·ƒç”¨æˆ·æ•°
    inactive: number;     // éæ´»è·ƒç”¨æˆ·æ•°
    locked: number;       // é”å®šç”¨æˆ·æ•°
  };
}
```

### 3. UserFiltersï¼ˆæœç´¢ç­›é€‰ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserFilters.tsx`

**åŠŸèƒ½**:
- å…¨å±€æœç´¢æ¡†ï¼ˆæ”¯æŒç”¨æˆ·åã€é‚®ç®±ã€çœŸå®å§“åï¼‰
- é«˜çº§ç­›é€‰é¢æ¿ï¼ˆå¯å±•å¼€/æ”¶èµ·ï¼‰
- ç­›é€‰æ¡ä»¶æ ‡ç­¾æ˜¾ç¤º
- æ¸…é™¤ç­›é€‰æŒ‰é’®

**ç­›é€‰å­—æ®µ**:
```typescript
interface UserFilters {
  search?: string;              // å…¨å±€æœç´¢å…³é”®è¯
  username?: string;            // ç”¨æˆ·å
  email?: string;               // é‚®ç®±
  phone?: string;               // æ‰‹æœºå·
  realName?: string;            // çœŸå®å§“å
  roleId?: number;              // è§’è‰²
  status?: 'all' | 'active' | 'inactive' | 'locked';  // çŠ¶æ€
  tenantId?: number;            // ç§Ÿæˆ·
  organizationId?: number;      // ç»„ç»‡
  dateRange?: {                 // æ—¶é—´èŒƒå›´
    from: Date;
    to: Date;
  };
  sortBy?: string;              // æ’åºå­—æ®µ
  sortOrder?: 'asc' | 'desc';   // æ’åºæ–¹å‘
  page?: number;                // é¡µç 
  limit?: number;               // æ¯é¡µæ•°é‡
}
```

**UIå¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” [å…¨å±€æœç´¢æ¡†]                        [æœç´¢] [é‡ç½®]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â–¼ é«˜çº§ç­›é€‰]                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ç”¨æˆ·å [______]  é‚®ç®± [______]  æ‰‹æœºå· [______]  â”‚    â”‚
â”‚ â”‚ çœŸå®å§“å [____]  è§’è‰² [ä¸‹æ‹‰é€‰æ‹©]  çŠ¶æ€ [ä¸‹æ‹‰é€‰æ‹©] â”‚    â”‚
â”‚ â”‚ æ—¶é—´èŒƒå›´ [ä»æ—¥æœŸ] è‡³ [è‡³æ—¥æœŸ]                     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ [Ã— ç”¨æˆ·å: admin] [Ã— çŠ¶æ€: active] [...æ›´å¤š] [æ¸…é™¤å…¨éƒ¨]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ViewToggleï¼ˆè§†å›¾åˆ‡æ¢ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/ViewToggle.tsx`

**åŠŸèƒ½**:
- åˆ‡æ¢è¡¨æ ¼è§†å›¾å’Œå¡ç‰‡è§†å›¾
- è§†å›¾çŠ¶æ€æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰

**è§†å›¾æ¨¡å¼**:
```typescript
type ViewMode = 'table' | 'card';
```

### 5. UserTableï¼ˆè¡¨æ ¼è§†å›¾ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserTable.tsx`

**åŠŸèƒ½**:
- è¡¨æ ¼å½¢å¼å±•ç¤ºç”¨æˆ·åˆ—è¡¨
- æ”¯æŒåˆ—æ’åº
- è¡Œé€‰æ‹©ï¼ˆå•é€‰/å…¨é€‰ï¼‰
- æ“ä½œåˆ—ï¼šç¼–è¾‘ã€åˆ é™¤ã€å¯ç”¨/ç¦ç”¨ã€é‡ç½®å¯†ç ã€ç»ˆæ­¢ä¼šè¯

**è¡¨æ ¼åˆ—**:
```typescript
interface UserTableColumns {
  select: Checkbox;              // é€‰æ‹©æ¡†
  userInfo: User;                // ç”¨æˆ·ä¿¡æ¯ï¼ˆå¤´åƒã€ç”¨æˆ·åã€é‚®ç®±ï¼‰
  phone: string;                 // æ‰‹æœºå·
  realName: string;              // çœŸå®å§“å
  role: Role;                    // è§’è‰²
  organization: Organization[];  // ç»„ç»‡
  status: StatusBadge;           // çŠ¶æ€
  activity: Timestamp;           // æœ€åæ´»åŠ¨æ—¶é—´
  actions: ActionButtons;        // æ“ä½œæŒ‰é’®
}
```

**æ“ä½œæŒ‰é’®**:
```typescript
interface ActionButtons {
  onEdit: (user: User) => void;        // ç¼–è¾‘
  onDelete: (user: User) => void;      // åˆ é™¤
  onEnable: (user: User) => void;      // å¯ç”¨
  onDisable: (user: User) => void;     // ç¦ç”¨
  onResetPassword: (user: User) => void; // é‡ç½®å¯†ç 
  onTerminateSessions: (user: User) => void; // ç»ˆæ­¢ä¼šè¯
}
```

### 6. UserCardGridï¼ˆå¡ç‰‡è§†å›¾ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserCardGrid.tsx`

**åŠŸèƒ½**:
- ç½‘æ ¼å¡ç‰‡å½¢å¼å±•ç¤ºç”¨æˆ·
- å“åº”å¼å¸ƒå±€ï¼ˆè‡ªåŠ¨è°ƒæ•´åˆ—æ•°ï¼‰
- å¡ç‰‡ä¸Šæ˜¾ç¤ºæ ¸å¿ƒä¿¡æ¯
- æ‚¬æµ®æ˜¾ç¤ºæ“ä½œèœå•

**å¡ç‰‡ä¿¡æ¯**:
- ç”¨æˆ·å¤´åƒå’Œå§“å
- è§’è‰²æ ‡ç­¾
- çŠ¶æ€å¾½ç« 
- é‚®ç®±å’Œæ‰‹æœºå·
- ç»„ç»‡åç§°

### 7. UserDialogsï¼ˆå¯¹è¯æ¡†ç®¡ç†ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserDialogs.tsx`

**åŠŸèƒ½**:
- ç®¡ç†æ‰€æœ‰ç”¨æˆ·ç›¸å…³å¯¹è¯æ¡†
- ç»Ÿä¸€çš„å¯¹è¯æ¡†çŠ¶æ€ç®¡ç†
- å¯¹è¯æ¡†ç±»å‹åŒ…æ‹¬ï¼š
  - åˆ›å»ºç”¨æˆ·å¯¹è¯æ¡†
  - ç¼–è¾‘ç”¨æˆ·å¯¹è¯æ¡†
  - åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
  - é‡ç½®å¯†ç å¯¹è¯æ¡†
  - ä¼šè¯ç®¡ç†å¯¹è¯æ¡†

**å¯¹è¯æ¡†çŠ¶æ€**:
```typescript
interface UserDialogState {
  type: 'create' | 'edit' | 'delete' | 'resetPassword' | 'sessions' | null;
  user: User | null;
  open: boolean;
}
```

### 8. UserFormï¼ˆç”¨æˆ·è¡¨å•ï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/UserForm.tsx`

**åŠŸèƒ½**:
- ç”¨æˆ·åˆ›å»º/ç¼–è¾‘è¡¨å•
- è¡¨å•éªŒè¯
- å¯†ç å¼ºåº¦æ£€æµ‹
- ç»„ç»‡é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰

**è¡¨å•å­—æ®µ**:
```typescript
interface UserFormData {
  username: string;           // ç”¨æˆ·å *å¿…å¡«
  email: string;              // é‚®ç®± *å¿…å¡«
  password?: string;          // å¯†ç ï¼ˆåˆ›å»ºæ—¶å¿…å¡«ï¼‰
  phone?: string;             // æ‰‹æœºå·
  realName?: string;          // çœŸå®å§“å
  roleId: number;             // è§’è‰² *å¿…å¡«
  organizationIds?: number[]; // ç»„ç»‡åˆ—è¡¨
  status?: 'active' | 'inactive' | 'locked'; // çŠ¶æ€
  metadata?: Record<string, any>; // æ‰©å±•æ•°æ®
  sendWelcomeEmail?: boolean; // æ˜¯å¦å‘é€æ¬¢è¿é‚®ä»¶
}
```

**éªŒè¯è§„åˆ™**:
```typescript
const validationRules = {
  username: {
    required: true,
    minLength: 3,
    maxLength: 50,
    pattern: /^[a-zA-Z0-9_-]+$/,
    message: 'ç”¨æˆ·åé•¿åº¦3-50å­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦'
  },
  email: {
    required: true,
    pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
  },
  password: {
    requiredOnCreate: true,
    minLength: 6,
    message: 'å¯†ç è‡³å°‘6ä½å­—ç¬¦'
  },
  phone: {
    pattern: /^1[3-9]\d{9}$/,
    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·'
  }
};
```

### 9. FloatingBatchActionsï¼ˆæµ®åŠ¨æ‰¹é‡æ“ä½œï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/components/FloatingBatchActions.tsx`

**åŠŸèƒ½**:
- é€‰ä¸­ç”¨æˆ·æ—¶æ˜¾ç¤ºæµ®åŠ¨æ“ä½œæ 
- æ‰¹é‡æ¿€æ´»/ç¦ç”¨/åˆ é™¤
- æ˜¾ç¤ºé€‰ä¸­æ•°é‡

**æ‰¹é‡æ“ä½œ**:
```typescript
interface BatchActions {
  onBatchActivate: () => void;    // æ‰¹é‡æ¿€æ´»
  onBatchDeactivate: () => void;  // æ‰¹é‡ç¦ç”¨
  onBatchDelete: () => void;      // æ‰¹é‡åˆ é™¤
  onClearSelection: () => void;   // æ¸…é™¤é€‰æ‹©
  selectedCount: number;          // é€‰ä¸­æ•°é‡
  visible: boolean;               // æ˜¯å¦æ˜¾ç¤º
}
```

## çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

### è‡ªå®šä¹‰Hooks

é¡µé¢ä½¿ç”¨ä¸‰ä¸ªä¸»è¦çš„è‡ªå®šä¹‰Hooksæ¥ç®¡ç†çŠ¶æ€ï¼š

```mermaid
graph LR
    A[page.tsx] --> B[useUserFilters]
    A --> C[useUserManagement]
    A --> D[useViewMode]

    B --> E[ç­›é€‰æ¡ä»¶çŠ¶æ€]
    C --> F[ç”¨æˆ·æ•°æ®çŠ¶æ€]
    C --> G[é€‰ä¸­ç”¨æˆ·çŠ¶æ€]
    D --> H[è§†å›¾æ¨¡å¼çŠ¶æ€]

    E --> I[fetchUsers APIè°ƒç”¨]
    I --> C
```

### 1. useUserFiltersï¼ˆç­›é€‰çŠ¶æ€Hookï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/hooks/useUserFilters.ts`

**åŠŸèƒ½**:
- ç®¡ç†æ‰€æœ‰ç­›é€‰æ¡ä»¶
- æä¾›ç­›é€‰æ›´æ–°æ–¹æ³•
- æ£€æµ‹æ˜¯å¦æœ‰æ¿€æ´»çš„ç­›é€‰æ¡ä»¶

**è¿”å›å€¼**:
```typescript
interface UseUserFiltersReturn {
  filters: UserFilters;           // å½“å‰ç­›é€‰æ¡ä»¶
  searchFilters: (keyword: string) => void;  // å…¨å±€æœç´¢
  updateFilters: (newFilters: Partial<UserFilters>) => void;  // æ›´æ–°ç­›é€‰
  updatePagination: (pagination: { page?: number; limit?: number }) => void;  // æ›´æ–°åˆ†é¡µ
  clearFilters: () => void;       // æ¸…é™¤æ‰€æœ‰ç­›é€‰
  hasActiveFilters: boolean;      // æ˜¯å¦æœ‰æ¿€æ´»çš„ç­›é€‰
}
```

**æ–¹æ³•è¯´æ˜**:
- `updateFilters`: é€šç”¨ç­›é€‰æ¡ä»¶æ›´æ–°æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ `searchFilters`ï¼Œç”¨äºè¡¨æ ¼æ’åºç­‰åœºæ™¯
- `searchFilters`: æ‰‹åŠ¨æœç´¢æ–¹æ³•ï¼Œæ”¯æŒ URL åŒæ­¥ï¼Œç­›é€‰æ¡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡ç½®åˆ°ç¬¬ä¸€é¡µ
- `updatePagination`: ä¸“é—¨ç”¨äºåˆ†é¡µæ›´æ–°çš„æ–¹æ³•ï¼Œé¿å…è§¦å‘ç­›é€‰æ¡ä»¶é‡ç½®
- `clearFilters`: æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶ï¼Œæ¢å¤é»˜è®¤çŠ¶æ€

### 2. useUserManagementï¼ˆç”¨æˆ·æ•°æ®Hookï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/hooks/useUserManagement.ts`

**åŠŸèƒ½**:
- ç®¡ç†ç”¨æˆ·åˆ—è¡¨æ•°æ®
- ç®¡ç†è§’è‰²åˆ—è¡¨æ•°æ®
- ç®¡ç†é€‰ä¸­ç”¨æˆ·çŠ¶æ€
- æä¾›æ‰€æœ‰ç”¨æˆ·æ“ä½œæ–¹æ³•

**è¿”å›å€¼**:
```typescript
interface UseUserManagementReturn {
  // æ•°æ®çŠ¶æ€
  users: User[];                  // ç”¨æˆ·åˆ—è¡¨
  roles: Role[];                  // è§’è‰²åˆ—è¡¨
  loading: boolean;               // åŠ è½½çŠ¶æ€
  pagination: PaginationInfo;     // åˆ†é¡µä¿¡æ¯
  statistics: UserStatistics;     // ç»Ÿè®¡æ•°æ®
  selectedUsers: number[];        // é€‰ä¸­çš„ç”¨æˆ·IDåˆ—è¡¨

  // æ•°æ®è·å–
  fetchUsers: (filters: UserFilters) => Promise<void>;

  // ç”¨æˆ·æ“ä½œ
  createUser: (data: UserFormData) => Promise<boolean>;
  updateUser: (id: number, data: Partial<UserFormData>) => Promise<boolean>;
  deleteUser: (id: number) => Promise<boolean>;
  changeUserStatus: (id: number, status: string) => Promise<boolean>;
  resetUserPassword: (id: number, newPassword: string, sendEmail: boolean) => Promise<boolean>;
  terminateUserSessions: (id: number, excludeCurrent: boolean) => Promise<boolean>;

  // æ‰¹é‡æ“ä½œ
  batchOperateUsers: (operation: string, userIds: number[]) => Promise<boolean>;

  // é€‰æ‹©ç®¡ç†
  toggleUserSelection: (userId: number) => void;
  selectAllUsers: () => void;
  clearUserSelection: () => void;
}
```

### 3. useViewModeï¼ˆè§†å›¾æ¨¡å¼Hookï¼‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/hooks/useViewMode.ts`

**åŠŸèƒ½**:
- ç®¡ç†è§†å›¾æ¨¡å¼ï¼ˆè¡¨æ ¼/å¡ç‰‡ï¼‰
- è§†å›¾æ¨¡å¼æŒä¹…åŒ–åˆ° localStorage
- æä¾›è§†å›¾åˆ‡æ¢æ–¹æ³•

**è¿”å›å€¼**:
```typescript
interface UseViewModeReturn {
  viewMode: 'table' | 'card';    // å½“å‰è§†å›¾æ¨¡å¼
  setViewMode: (mode: 'table' | 'card') => void;  // è®¾ç½®è§†å›¾æ¨¡å¼
  isInitialized: boolean;        // æ˜¯å¦å·²åˆå§‹åŒ–
}
```

## æ•°æ®æµè®¾è®¡

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·æ“ä½œ
    participant H as useUserManagement Hook
    participant A as APIè°ƒç”¨
    participant D as æ•°æ®åº“

    U->>H: ç‚¹å‡»æœç´¢/ç­›é€‰
    H->>A: fetchUsers(filters)
    A->>D: SELECT ... WHERE ...
    D-->>A: è¿”å›ç”¨æˆ·æ•°æ®
    A-->>H: { users, pagination, statistics }
    H->>H: æ›´æ–°çŠ¶æ€
    H-->>U: é‡æ–°æ¸²æŸ“UI

    U->>H: ç‚¹å‡»åˆ›å»ºç”¨æˆ·
    H->>A: createUser(formData)
    A->>D: INSERT INTO users ...
    D-->>A: æ–°ç”¨æˆ·ID
    A-->>H: æˆåŠŸ/å¤±è´¥
    H->>H: fetchUsers()
    H-->>U: åˆ·æ–°åˆ—è¡¨
```

## è§†å›¾æ¨¡å¼åˆ‡æ¢æœºåˆ¶

```mermaid
stateDiagram-v2
    [*] --> è¡¨æ ¼è§†å›¾: åˆå§‹åŒ–ï¼ˆä»localStorageè¯»å–ï¼‰
    è¡¨æ ¼è§†å›¾ --> å¡ç‰‡è§†å›¾: ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢æŒ‰é’®
    å¡ç‰‡è§†å›¾ --> è¡¨æ ¼è§†å›¾: ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢æŒ‰é’®
    è¡¨æ ¼è§†å›¾ --> [*]: é¡µé¢å¸è½½
    å¡ç‰‡è§†å›¾ --> [*]: é¡µé¢å¸è½½

    note right of è¡¨æ ¼è§†å›¾
        é€‚åˆå¤§æ•°æ®é‡
        æ”¯æŒåˆ—æ’åº
        ä¿¡æ¯å¯†åº¦é«˜
    end note

    note right of å¡ç‰‡è§†å›¾
        è§†è§‰å‹å¥½
        å“åº”å¼å¸ƒå±€
        é€‚åˆç§»åŠ¨ç«¯
    end note
```

## æƒé™æ§åˆ¶å®ç°

é¡µé¢ä½¿ç”¨ `PermissionGuard` ç»„ä»¶è¿›è¡Œæƒé™æ§åˆ¶ï¼š

```typescript
import { PermissionGuard } from '@/components/auth/permission-guard';
import { PERMISSIONS } from '@/lib/permissions';

// ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ·æŒ‰é’®éœ€è¦ç‰¹å®šæƒé™
<PermissionGuard permissions={PERMISSIONS.USER.CREATE}>
  <Button onClick={handleOpenCreateDialog}>
    æ·»åŠ ç”¨æˆ·
  </Button>
</PermissionGuard>
```

**æƒé™å®šä¹‰** (`src/lib/permissions.ts`):
```typescript
export const PERMISSIONS = {
  USER: {
    CREATE: 'user.create',
    READ: 'user.read',
    UPDATE: 'user.update',
    DELETE: 'user.delete',
    EXPORT: 'user.export',
    IMPORT: 'user.import',
    RESET_PASSWORD: 'user.resetPassword',
    MANAGE_SESSIONS: 'user.manageSessions'
  }
};
```

**è¶…çº§ç®¡ç†å‘˜ä¿æŠ¤**:
```typescript
// è¶…çº§ç®¡ç†å‘˜ä¸èƒ½è¢«åˆ é™¤ã€ç¦ç”¨æˆ–ä¿®æ”¹å¯†ç 
if (user.isSuperAdmin) {
  // éšè—æˆ–ç¦ç”¨ç›¸å…³æ“ä½œæŒ‰é’®
  return;
}
```

## åˆ†é¡µé…ç½®

**åˆ†é¡µé€‰é¡¹** (`src/app/dashboard/account/user/constants.ts`):
```typescript
export const PAGE_SIZE_OPTIONS = [10, 20, 30, 50, 100];

export const DEFAULT_PAGINATION = {
  page: 1,
  limit: 10,
  total: 0,
  totalPages: 0
};
```

**åˆ†é¡µç»„ä»¶**: ä½¿ç”¨é€šç”¨çš„ `Pagination` ç»„ä»¶ (`src/components/table/pagination`)

## ç©ºçŠ¶æ€è®¾è®¡

é¡µé¢è®¾è®¡äº†ä¸¤ç§ç©ºçŠ¶æ€ï¼š

1. **æ— æ•°æ®çŠ¶æ€**ï¼ˆæ— ç­›é€‰æ¡ä»¶æ—¶ï¼‰:
   - å›¾æ ‡ï¼šUserså›¾æ ‡
   - æ ‡é¢˜ï¼šè¿˜æ²¡æœ‰ç”¨æˆ·
   - æè¿°ï¼šå¼€å§‹æ·»åŠ ç”¨æˆ·æ¥ç®¡ç†æ‚¨çš„ç³»ç»Ÿ
   - æ“ä½œï¼šæ·»åŠ ç”¨æˆ·æŒ‰é’®

2. **æ— ç»“æœçŠ¶æ€**ï¼ˆæœ‰ç­›é€‰æ¡ä»¶æ—¶ï¼‰:
   - å›¾æ ‡ï¼šUserså›¾æ ‡
   - æ ‡é¢˜ï¼šæœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·
   - æè¿°ï¼šè¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶ä»¥æŸ¥çœ‹æ›´å¤šç»“æœ

## åŠ è½½çŠ¶æ€

- å…¨å±€åŠ è½½ï¼šé¡µé¢åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å±
- æ“ä½œåŠ è½½ï¼šæŒ‰é’®ç‚¹å‡»åæ˜¾ç¤ºloadingçŠ¶æ€
- æ•°æ®åˆ·æ–°ï¼šåˆ·æ–°æ—¶åœ¨ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºloadingåŠ¨ç”»

## å“åº”å¼è®¾è®¡

```mermaid
graph LR
    A[æ¡Œé¢ç«¯ >1024px] --> B[è¡¨æ ¼è§†å›¾ï¼š10åˆ—]
    C[å¹³æ¿ç«¯ 768-1024px] --> D[è¡¨æ ¼è§†å›¾ï¼šç²¾ç®€åˆ—]
    E[ç§»åŠ¨ç«¯ <768px] --> F[å¡ç‰‡è§†å›¾ï¼šè‡ªåŠ¨åˆ—æ•°]

    B --> G[ä¾§è¾¹æ å¯¼èˆª]
    D --> H[æŠ½å±‰å¼å¯¼èˆª]
    F --> I[åº•éƒ¨å¯¼èˆªæ ]
```

**æ–­ç‚¹é…ç½®**:
```typescript
const breakpoints = {
  sm: '640px',   // ç§»åŠ¨ç«¯
  md: '768px',   // å¹³æ¿
  lg: '1024px',  // æ¡Œé¢
  xl: '1280px',  // å¤§å±
  '2xl': '1536px' // è¶…å¤§å±
};
```

## å…³é”®å¸¸é‡å®šä¹‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/constants.ts`

```typescript
// å¯¹è¯æ¡†ç±»å‹
export const DIALOG_TYPES = {
  CREATE: 'create',
  EDIT: 'edit',
  DELETE: 'delete',
  RESET_PASSWORD: 'resetPassword',
  SESSIONS: 'sessions'
};

// ç”¨æˆ·çŠ¶æ€
export const USER_STATUS = {
  ACTIVE: 'active',
  INACTIVE: 'inactive',
  LOCKED: 'locked'
};

// æ’åºå­—æ®µ
export const SORT_FIELDS = {
  USERNAME: 'username',
  EMAIL: 'email',
  CREATED_AT: 'createdAt',
  LAST_LOGIN_AT: 'lastLoginAt'
};
```

## TypeScriptç±»å‹å®šä¹‰

**æ–‡ä»¶**: `src/app/dashboard/account/user/types.ts`

```typescript
// ç”¨æˆ·ç±»å‹
export interface User {
  id: number;
  username: string;
  email: string;
  phone?: string;
  realName?: string;
  roleId: number;
  tenantId: number;
  avatar?: string;
  status: 'active' | 'inactive' | 'locked';
  isSuperAdmin: boolean;
  lastLoginAt?: string;
  createdAt: string;
  updatedAt: string;
  metadata?: Record<string, any>;
  role?: Role;
  organizations?: Organization[];
}

// ç”¨æˆ·è¡¨å•æ•°æ®
export interface UserFormData {
  username: string;
  email: string;
  password?: string;
  phone?: string;
  realName?: string;
  roleId: number;
  tenantId?: number;
  organizationIds?: number[];
  status?: 'active' | 'inactive' | 'locked';
  metadata?: Record<string, any>;
  sendWelcomeEmail?: boolean;
}

// ç­›é€‰æ¡ä»¶
export interface UserFilters {
  search?: string;
  username?: string;
  email?: string;
  phone?: string;
  realName?: string;
  roleId?: number;
  status?: 'all' | 'active' | 'inactive' | 'locked';
  tenantId?: number;
  organizationId?: number;
  dateRange?: {
    from: Date;
    to: Date;
  };
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}

// åˆ†é¡µä¿¡æ¯
export interface PaginationInfo {
  page: number;
  limit: number;
  total: number;
  totalPages: number;
}

// å¯¹è¯æ¡†çŠ¶æ€
export interface UserDialogState {
  type: 'create' | 'edit' | 'delete' | 'resetPassword' | 'sessions' | null;
  user: User | null;
  open: boolean;
}
```

## æ€»ç»“

ç”¨æˆ·ç®¡ç†é¡µé¢é‡‡ç”¨ç°ä»£åŒ–çš„ React ç»„ä»¶è®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ç»„ä»¶åŒ–æ¶æ„**: åŠŸèƒ½æ¨¡å—é«˜åº¦è§£è€¦ï¼Œæ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€
2. **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨è‡ªå®šä¹‰ Hooks é›†ä¸­ç®¡ç†çŠ¶æ€ï¼Œé€»è¾‘æ¸…æ™°
3. **åŒè§†å›¾æ¨¡å¼**: æ”¯æŒè¡¨æ ¼å’Œå¡ç‰‡ä¸¤ç§è§†å›¾ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
4. **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æƒé™éªŒè¯ï¼Œè¶…çº§ç®¡ç†å‘˜ä¿æŠ¤æœºåˆ¶
5. **ç”¨æˆ·ä½“éªŒ**: ä¸°å¯Œçš„äº¤äº’åé¦ˆã€ç©ºçŠ¶æ€è®¾è®¡ã€åŠ è½½çŠ¶æ€å¤„ç†
6. **å“åº”å¼è®¾è®¡**: é€‚é…å¤šç§è®¾å¤‡å°ºå¯¸
7. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

è¿™ä¸ªè®¾è®¡ä¸ºç”¨æˆ·ç®¡ç†æä¾›äº†å®Œæ•´ã€æ˜“ç”¨ã€å®‰å…¨çš„æ“ä½œç•Œé¢ã€‚
